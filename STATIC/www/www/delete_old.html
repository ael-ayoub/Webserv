<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DELETE Method - Webserv</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <header>
        <h1>DELETE Method Test</h1>
    </header>
    
    <nav>
        <ul>
            <li><a href="/index.html">Home</a></li>
            <li><a href="/about.html">About</a></li>
            <li><a href="/upload.html">Upload File</a></li>
            <li><a href="/form.html">POST Form</a></li>
            <li><a href="/search.html">Search (GET)</a></li>
            <li><a href="/delete.html">Delete Test</a></li>
        </ul>
    </nav>
    
    <main>
        <section>
            <h2>Delete File Test</h2>
            <p>Use JavaScript to send DELETE requests to the server</p>
            
            <div class="delete-section">
                <h3>Delete Uploaded Files</h3>
                <div class="form-group">
                    <label for="filename">File to Delete:</label>
                    <input type="text" id="filename" placeholder="e.g., test.txt">
                </div>
                <button onclick="deleteFile()">Delete File</button>
                <div id="deleteResult" class="result"></div>
            </div>
        </section>
        
        <section>
            <h2>Manage Files</h2>
            <p>Test files for deletion (create these first via upload):</p>
            <ul>
                <li>test.txt</li>
                <li>sample.html</li>
                <li>data.json</li>
            </ul>
            
            <div class="file-list">
                <h3>Quick Delete Buttons:</h3>
                <button onclick="deleteSpecificFile('test.txt')">Delete test.txt</button>
                <button onclick="deleteSpecificFile('sample.html')">Delete sample.html</button>
                <button onclick="deleteSpecificFile('data.json')">Delete data.json</button>
            </div>
        </section>
        
        <section>
            <h2>Testing Instructions</h2>
            <ol>
                <li>First, upload some test files using the <a href="/upload.html">Upload page</a></li>
                <li>Note the filenames of uploaded files</li>
                <li>Return here and enter the filename to delete</li>
                <li>Click "Delete File" button</li>
                <li>Check the response status (should be 200 or 204 on success)</li>
            </ol>
            
            <h3>Test with curl:</h3>
            <pre><code>curl -X DELETE http://localhost:8080/uploads/test.txt</code></pre>
            
            <h3>Expected Responses:</h3>
            <ul>
                <li><strong>200 OK</strong> or <strong>204 No Content</strong> - File deleted successfully</li>
                <li><strong>404 Not Found</strong> - File doesn't exist</li>
                <li><strong>403 Forbidden</strong> - No permission to delete</li>
                <li><strong>405 Method Not Allowed</strong> - DELETE not allowed for this resource</li>
            </ul>
        </section>
    </main>
    
    <footer>
        <p><a href="/index.html">Back to Home</a></p>
    </footer>
    
    <script>
        function deleteFile() {
            const filename = document.getElementById('filename').value.trim();
            if (!filename) {
                document.getElementById('deleteResult').innerHTML = 
                    '<p style="color: red;">Please enter a filename</p>';
                return;
            }
            
            deleteSpecificFile(filename);
        }
        
        function deleteSpecificFile(filename) {
            const url ="../../upload/" + encodeURIComponent(filename);
            
            fetch(url, {
                method: 'DELETE'
            })
            .then(response => {
                const resultDiv = document.getElementById('deleteResult') || createResultDiv();
                
                if (response.ok) {
                    resultDiv.innerHTML = 
                        `<p style="color: green;">✓ File "${filename}" deleted successfully (Status: ${response.status})</p>`;
                } else {
                    resultDiv.innerHTML = 
                        `<p style="color: red;">✗ Failed to delete "${filename}" (Status: ${response.status} ${response.statusText})</p>`;
                }
                
                return response.text();
            })
            .then(text => {
                console.log('Server response:', text);
            })
            .catch(error => {
                const resultDiv = document.getElementById('deleteResult') || createResultDiv();
                resultDiv.innerHTML = 
                    `<p style="color: red;">Error: ${error.message}</p>`;
            });
        }
        
        function createResultDiv() {
            const div = document.createElement('div');
            div.id = 'deleteResult';
            div.className = 'result';
            document.querySelector('.file-list').appendChild(div);
            return div;
        }
    </script>
</body>
</html>